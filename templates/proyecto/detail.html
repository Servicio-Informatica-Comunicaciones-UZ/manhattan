{% extends 'base.html' %}
{% load custom_tags i18n %}
{% block content %}
<div class="container-blanco">
  <div class="alert alert-info">
    <span class="fas fa-info-circle"></span>
    <div>
      {% trans 'Puede editar su solicitud tantas veces como desee.' %}<br />
      {% trans 'Cuando esté satisfecho, pulse el botón «Presentar».' %}
      {% trans 'Una vez haya presentado la solicitud, ya no podrá modificarla.' %}
    </div>
  </div>

  <h1>{{ proyecto.titulo }}</h1>
  {# DetailView proporciona el objeto de contexto `proyecto` #}
  <hr />
  <br />

  <div class="table-responsive">
    <table class="table table-hover table-striped table-sm">
      <tr><td><strong>{% trans 'Convocatoria' %}</strong>:</td><td>{{ proyecto.convocatoria_id }}</td></tr>
      <tr>
        <td><strong>{% trans 'Programa' %}</strong>:</td>
        <td>{{ proyecto.programa.nombre_corto }} ({{ proyecto.programa.nombre_largo }})</td>
      </tr>
      {% if proyecto.linea %}
        <tr><td><strong>{% trans 'Línea' %}</strong>:</td><td>{{ proyecto.linea.nombre }}</td></tr>
      {% endif %}
      {% if proyecto.centro %}
        <tr><td><strong>{% trans 'Centro' %}</strong>:</td><td><{{ proyecto.centro.nombre }}/td></tr>
      {% endif %}
      {% if proyecto.estudio %}
        <tr><td><strong>{% trans 'Estudio' %}</strong>:</td><td>{{ proyecto.estudio.nombre }}</td></tr>
      {% endif %}
      {% if coordinador_principal %}
        <tr>
          <td><strong>{{ coordinador_principal.get_cargo }}</strong>:</td>
          <td>{{ coordinador_principal.usuario.get_full_name }}</td>
        </tr>
      {% endif %}
      {% if coordinador %}
        <tr><td><strong>{{ coordinador.get_cargo }}</strong>:</td><td>{{ coordinador.usuario.get_full_name }}</td></tr>
      {% endif %}
      <tr><td><strong>{% trans 'Estado' %}</strong>:</td><td>{{ proyecto.get_estado_display }}</td></tr>
    </table>
  </div><br />

  <h3>{% trans 'Invitaciones' %}</h3>
  {% if invitados %}
    <div class="table-responsive">
      <table class="table table-hover table-striped table-sm">
        {% for invitado in invitados %}
          <tr>
            <td>{{ invitado.usuario.get_full_name }}</td>
            <td>{% if invitado.tipo_participacion_id == "invitado" %}{% trans "Pendiente" %}{% else %}{% trans "Declinada" %}{% endif %}</td>
            <td><a href={% url 'participante_delete' invitado.id %} aria-label="{% trans "Eliminar" %}"><span aria-hidden="true" class="fas fa-trash-alt" title="{% trans "Eliminar" %}"></span></a></td>
          </tr>
        {% endfor %}
      </table>
    </div>
  {% else %}
    <p>{% trans 'Aquí aparecerán las personas a las que invite a participar en este proyecto.'%}</p>
  {% endif %}
  <p>
    <a href="{% url 'participante_invitar' proyecto.id %}" class="btn btn-info btn-sm"
      ><span class="fas fa-plus" aria-hidden="true"></span>&nbsp; {% trans 'Añadir' %}</a>
  </p><br />

  <h3>{% trans 'Participantes' %}</strong></h3>
  {% if participantes %}
    <div class="table-responsive">
      <table class="table table-hover table-striped table-sm">
        {% for participante in participantes %}
          <tr>
            <td>{{ participante.usuario.get_full_name }}</td>
            <td><a href={% url 'participante_delete' participante.id %} aria-label="{% trans "Eliminar" %}">
              <span aria-hidden="true" class="fas fa-trash-alt" title="{% trans "Eliminar" %}"></span>
            </a></td>
          </tr>
        {% endfor %}
      </table>
    </div>
  {% else %}
    <p>{% trans 'Aquí aparecerán las personas que acepten la invitación a participar en este proyecto.'%}</p>
  {% endif %}
  <br />

  {# TODO: filtro para HTML procedente de procesador de textos #}
  <h3>{% trans 'Descripción' %}</h3>
  <p>{{ proyecto.descripcion | safe }}</p>
  <p>
    <a href="{% url 'proyecto_update_field' proyecto.id "descripcion" %}" class="btn btn-info btn-sm">
      <span class="fas fa-pencil-alt" aria-hidden="true"></span>&nbsp; {% trans 'Editar' %}
    </a>
  </p>

  {% for campo in campos %}
    <h3>{{ proyecto | get_attr_verbose_name:campo }}</h3>
    <p>{{ proyecto | get_obj_attr:campo | default:"" | safe }}</p>
    <p>
      <a href="{% url 'proyecto_update_field' proyecto.id campo %}" class="btn btn-info btn-sm">
        <span class="fas fa-pencil-alt" aria-hidden="true"></i>&nbsp; {% trans 'Editar' %}
      </span>
    </p>
  {% endfor %}

  <h3>{{ proyecto | get_attr_verbose_name:"ayuda" }}</h3>
  <p>{{ proyecto.ayuda | default:"" }}</p>
  <p>
    <a href="{% url 'proyecto_update_field' proyecto.id "ayuda" %}" class="btn btn-info btn-sm">
      <span class="fas fa-pencil-alt" aria-hidden="true"></span>&nbsp; {% trans 'Editar' %}
    </a>
  </p>

  <h3>{{ proyecto | get_attr_verbose_name:"financiacion" }}</h3>
  <p>{{ proyecto.financiacion | default:"" | safe }}</p>
  <p>
    <a href="{% url 'proyecto_update_field' proyecto.id "financiacion" %}" class="btn btn-info btn-sm">
      <span class="fas fa-pencil-alt" aria-hidden="true"></span>&nbsp; {% trans 'Editar' %}
    </a>
  </p>

  <br style="clear: both;" />
  <div class="btn-group" role="group" aria-label="Botones">
    <a href="{% url 'proyectos_usuario_list' %}" class="btn btn-info">
      <span class="fas fa-step-backward"></span> {% trans 'Retroceder' %}
    </a>
    <button class="btn btn-warning" data-toggle="modal" data-target="#presentarModal" type="button">
      <span class="fas fa-check"></span> {% trans 'Presentar' %}
    </button>
  </div>
</div>


<div class="modal fade" id="presentarModal" tabindex="-1" role="dialog" aria-labelledby="presentarModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="presentarModalLabel">{% trans "¿Seguro que desea presentar la solicitud?" %}</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Cerrar">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <p>{% trans "Una vez presentada ya no podrá hacer ningún cambio." %}</p>
        <p>{% trans "Se enviarán mensajes informativos a las personas invitadas y, en su caso, a quien deba dar su visto bueno." %}</p>
        <p>{% blocktrans %}Al presentar la solicitud, usted se compromete, en caso de concesión,
          a cumplir con las obligaciones establecidas en las bases de la convocatoria."{% endblocktrans %}</p>
      </div>
      <div class="modal-footer">
        <form action="{% url 'proyecto_presentar' pk=proyecto.id %}" id="presentar-form" method="post">
          {% csrf_token %}
          <button type="button" class="btn btn-info" data-dismiss="modal"><span class="fas fa-times"></span> {% trans "Cancelar" %}</button>
          <button type="submit" class="btn btn-warning"><span class="fas fa-check"></span> {% trans "Presentar" %}</button>
        </form>
      </div>
    </div>
  </div>
</div>

{% endblock content %}